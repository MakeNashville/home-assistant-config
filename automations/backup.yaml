- id: backup_config_github
  alias: Backup Config to GitHub
  description: Automatically backup HA config to GitHub then reload
  triggers:
  - at: 03:00:00
    trigger: time
  - trigger: homeassistant
    event: start
  actions:
  - sequence:
    - action: python_script.write_entity_list
    - action: hassio.addon_stdin
      data:
        addon: core_ssh
        input: /config/git_backup.sh
    - action: notify.make_nashville
      data:
        target: "#deployment-feed"
        message: ":white_check_mark: Config backup to GitHub completed. Reloading HA at {{ now().strftime('%a %b %-d %-I:%M %p') }}."
        data:
          username: HA Backup
          icon: floppy_disk
    - delay:
        seconds: 5
    - action: automation.reload
    - action: script.reload
    - action: homeassistant.reload_core_config
  mode: single

